name: Check build

on:
    push:
        branches: ["main"]
    pull_request:
        branches: ["main"]

jobs:
    test:
        runs-on: ubuntu-latest
        env:
            DEV_MODE: "true"
            GOOGLE_CLIENT_ID: "401008546765-0ecbubggp6gra24vlbno1v3bt4d6pnci.apps.googleusercontent.com"
            FRONTEND_URL: "http://localhost:5127"
            COOKIE_DOMAIN: "localhost"
            JWT_SECRET_ACCESS: "1fS96nCAldGuUQ9YpSJVIWAngCdbBG"
            JWT_SECRET_REFRESH: "2La9JgQhaWPXO1MRa14KMC3uGfBLuF"
            SESSION_EXP_TIME: "10800000"
            JWT_ACCESS_EXP: "3h"
            JWT_REFRESH_EXP: "3d"
            SWAGGER_HOST: "localhost:3000"
            SWAGGER_SCHEMA: "http"
        steps:
            - name: ðŸ“¥ Checkout repository
              uses: actions/checkout@v4

            - name: ðŸ“¦ Run doker compose
              run: docker compose up --build

    build:
        runs-on: ubuntu-latest
        env:
            DEV_MODE: "false"
            GOOGLE_CLIENT_ID: "401008546765-0ecbubggp6gra24vlbno1v3bt4d6pnci.apps.googleusercontent.com"
            FRONTEND_URL: "http://localhost:5127"
            COOKIE_DOMAIN: "localhost"
            JWT_SECRET_ACCESS: "1fS96nCAldGuUQ9YpSJVIWAngCdbBG"
            JWT_SECRET_REFRESH: "2La9JgQhaWPXO1MRa14KMC3uGfBLuF"
            SESSION_EXP_TIME: "10800000"
            JWT_ACCESS_EXP: "3h"
            JWT_REFRESH_EXP: "3d"
            SWAGGER_HOST: "localhost:3000"
            SWAGGER_SCHEMA: "http"
        steps:
            - name: ðŸ“¥ Checkout repository
              uses: actions/checkout@v4
            - name: ðŸŸ¨ Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: 20

            - name: ðŸ“¦ Install dependencies
              run: npm ci
              working-directory: server/

            - name: ðŸ”§ Compile TypeScript
              run: npm run build
              working-directory: server/

            - name: âœ… Show output files
              working-directory: server/
              run: ls -R dist

            - name: ðŸ“¦ Run doker compose
              run: docker compose up --build
